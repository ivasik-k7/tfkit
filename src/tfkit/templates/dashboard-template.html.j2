<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        :root {
            --bg-primary: {{ theme_colors.bg_primary }};
            --bg-secondary: {{ theme_colors.bg_secondary }};
            --bg-tertiary: {{ theme_colors.bg_tertiary }};
            --text-primary: {{ theme_colors.text_primary }};
            --text-secondary: {{ theme_colors.text_secondary }};
            --border: {{ theme_colors.border }};
            --accent: {{ theme_colors.accent }};
            --accent-secondary: {{ theme_colors.accent_secondary }};
            --success: {{ theme_colors.success }};
            --warning: {{ theme_colors.warning }};
            --danger: {{ theme_colors.danger }};
            --info: {{ theme_colors.info }};
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .quick-actions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: {{ theme_colors.bg_secondary }}d0;
            border: 1px solid {{ theme_colors.border }};
            border-radius: 50px;
            padding: 12px 20px;
            display: flex;
            gap: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 9999;
            backdrop-filter: blur(10px);
        }
        .quick-action {
            background: {{ theme_colors.bg_primary }};
            border: 1px solid {{ theme_colors.border }};
            color: {{ theme_colors.text_primary }};
            padding: 12px 16px;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-size: 0.9em;
            font-weight: 500;
        }
        .quick-action:hover {
            background: {{ theme_colors.accent }};
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px {{ theme_colors.accent }};
        }
        .quick-action:active {
            transform: translateY(0);
        }
    </style>
    <style>
        /* Command Palette Enhanced Styles */
        .command-palette {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%) scale(0.95);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
            width: 90%;
            max-width: 680px;
            max-height: 70vh;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .command-palette.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) scale(1);
        }

        .command-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 16px;
            background: var(--bg-secondary);
            position: relative;
        }

        .command-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                    transparent 0%,
                    var(--border) 20%,
                    var(--border) 80%,
                    transparent 100%);
        }

        .command-input {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.3em;
            flex: 1;
            outline: none;
            font-weight: 500;
            padding: 8px 0;
            caret-color: var(--accent);
        }

        .command-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        .command-shortcut {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75em;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-weight: 600;
            letter-spacing: 0.5px;
            border: 1px solid var(--border);
            opacity: 0.8;
        }

        .command-list {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
            padding: 8px 0;
            scroll-behavior: smooth;
        }

        .command-category {
            padding: 16px 24px 8px;
            font-size: 0.7em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 2;
            border-bottom: 1px solid var(--border);
            margin-bottom: 4px;
            opacity: 0.9;
        }

        .command-item {
            padding: 14px 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            margin: 2px 8px;
            border-radius: 10px;
            position: relative;
            background: transparent;
        }

        .command-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(4px);
            border-color: var(--border);
        }

        .command-item.selected {
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            color: white;
            border-color: var(--accent);
            transform: translateX(8px);
            box-shadow: 0 6px 20px rgba(var(--accent-rgb), 0.3);
        }

        .command-item.selected .command-icon {
            color: white;
        }

        .command-item.selected .command-title,
        .command-item.selected .command-description {
            color: white;
        }

        .command-item.selected .command-shortcut-item {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .command-item.selected mark {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .command-icon {
            width: 20px;
            text-align: center;
            color: var(--accent);
            font-size: 1.1em;
            flex-shrink: 0;
            transition: color 0.2s ease;
        }

        .command-content {
            flex: 1;
            min-width: 0;
        }

        .command-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.95em;
            color: var(--text-primary);
            transition: color 0.2s ease;
        }

        .command-description {
            font-size: 0.82em;
            color: var(--text-secondary);
            line-height: 1.4;
            transition: color 0.2s ease;
        }

        .command-shortcut-item {
            background: var(--bg-primary);
            color: var(--text-secondary);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.72em;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-weight: 600;
            letter-spacing: 0.5px;
            border: 1px solid var(--border);
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .command-empty-state {
            padding: 48px 24px;
            text-align: center;
            color: var(--text-secondary);
        }

        .command-empty-state i {
            font-size: 2em;
            margin-bottom: 16px;
            opacity: 0.4;
        }

        .command-empty-hint {
            font-size: 0.85em;
            margin-top: 8px;
            opacity: 0.6;
        }

        /* Modal Styles - Enhanced with Better Animations */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(12px);
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: modalFadeIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            will-change: opacity;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) both;
            will-change: transform, opacity;
            transform-origin: center center;
        }

        .modal-header {
            padding: 28px 32px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
            position: relative;
        }

        .modal-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                    transparent 0%,
                    var(--border) 15%,
                    var(--border) 85%,
                    transparent 100%);
        }

        .modal-header h3 {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            letter-spacing: -0.01em;
        }

        .modal-close {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1.3em;
            position: relative;
            overflow: hidden;
        }

        .modal-close::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(var(--accent-rgb), 0.1), transparent);
            transition: left 0.6s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
            transform: scale(1.1) rotate(90deg);
        }

        .modal-close:hover::before {
            left: 100%;
        }

        .modal-body {
            padding: 28px 32px;
            overflow-y: auto;
            max-height: calc(85vh - 100px);
            scroll-behavior: smooth;
        }

        /* Help Modal Styles */
        .help-modal h3 {
            color: var(--text-primary);
            margin-bottom: 24px;
            font-size: 1.4em;
            font-weight: 700;
        }

        .shortcut-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 14px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .shortcut-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(6px);
            border-color: var(--accent);
            box-shadow: 0 4px 20px rgba(var(--accent-rgb), 0.15);
        }

        .shortcut-item .keys {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .shortcut-item kbd {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 10px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.9em;
            font-weight: 600;
            color: var(--text-primary);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .shortcut-item:hover kbd {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .shortcut-item .description {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.95em;
        }

        /* Search Modal Styles */
        .search-modal {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .search-input {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 14px;
            padding: 18px 20px;
            color: var(--text-primary);
            font-size: 1.1em;
            outline: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            caret-color: var(--accent);
        }

        .search-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(var(--accent-rgb), 0.15);
            transform: translateY(-2px);
        }

        .search-results {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-result-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(6px);
            border-color: var(--accent);
            box-shadow: 0 4px 20px rgba(var(--accent-rgb), 0.15);
        }

        .result-icon {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 12px;
            color: var(--accent);
            font-size: 1.3em;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .search-result-item:hover .result-icon {
            background: var(--accent);
            color: white;
            transform: scale(1.1);
        }

        .result-content {
            flex: 1;
            min-width: 0;
        }

        .result-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            font-size: 1em;
        }

        .result-subtitle {
            font-size: 0.88em;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .result-type {
            font-size: 0.75em;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 8px;
            display: inline-block;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .no-results {
            text-align: center;
            padding: 60px 24px;
            color: var(--text-secondary);
        }

        .no-results i {
            font-size: 2.5em;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* Settings Modal Styles */
        .settings-modal {
            display: flex;
            flex-direction: column;
            gap: 36px;
        }

        .setting-group h4 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 700;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 14px;
            margin-bottom: 14px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .setting-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
            transform: translateX(4px);
        }

        .setting-item label {
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 14px;
            font-size: 0.95em;
        }

        .setting-item select,
        .setting-item input[type="text"],
        .setting-item input[type="number"] {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px 14px;
            color: var(--text-primary);
            outline: none;
            min-width: 140px;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .setting-item select:focus,
        .setting-item input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(var(--accent-rgb), 0.1);
        }

        .setting-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        /* Enhanced Toast Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10003;
            display: flex;
            flex-direction: column;
            gap: 14px;
            max-width: 400px;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-left: 4px solid var(--accent);
            padding: 18px 22px;
            border-radius: 14px;
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.25);
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            gap: 14px;
            pointer-events: auto;
            backdrop-filter: blur(20px);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast.info {
            border-left-color: var(--info);
        }

        .toast.loading {
            border-left-color: var(--accent);
        }

        .toast.success .toast-content i {
            color: var(--success);
        }

        .toast.error .toast-content i {
            color: var(--danger);
        }

        .toast.warning .toast-content i {
            color: var(--warning);
        }

        .toast.info .toast-content i {
            color: var(--info);
        }

        .toast.loading .toast-content i {
            color: var(--accent);
        }

        .toast-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .toast-content i {
            font-size: 1.3em;
            flex-shrink: 0;
        }

        .toast-content span {
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.4;
            font-size: 0.95em;
        }

        /* Text Highlighting */
        mark {
            background: rgba(var(--accent-rgb), 0.2);
            color: var(--accent);
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 700;
            box-shadow: 0 1px 3px rgba(var(--accent-rgb), 0.2);
        }

        /* Enhanced Animations */
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                backdrop-filter: blur(0px);
            }

            to {
                opacity: 1;
                backdrop-filter: blur(12px);
            }
        }

        @keyframes modalSlideIn {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(40px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Focus Management */
        .command-input:focus {
            box-shadow: none;
        }

        .modal-close:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        /* Scrollbar Styling */
        .command-list::-webkit-scrollbar,
        .modal-body::-webkit-scrollbar,
        .search-results::-webkit-scrollbar {
            width: 8px;
        }

        .command-list::-webkit-scrollbar-track,
        .modal-body::-webkit-scrollbar-track,
        .search-results::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 4px;
            margin: 4px;
        }

        .command-list::-webkit-scrollbar-thumb,
        .modal-body::-webkit-scrollbar-thumb,
        .search-results::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
            border: 2px solid var(--bg-primary);
        }

        .command-list::-webkit-scrollbar-thumb:hover,
        .modal-body::-webkit-scrollbar-thumb:hover,
        .search-results::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .command-palette {
                width: 95%;
                top: 5%;
                max-height: 85vh;
                border-radius: 20px;
            }

            .command-header {
                padding: 20px;
            }

            .command-input {
                font-size: 1.1em;
            }

            .command-item {
                padding: 16px 20px;
                margin: 2px 4px;
            }

            .command-category {
                padding: 14px 20px 8px;
            }

            .modal-content {
                margin: 10px;
                max-height: 90vh;
                border-radius: 24px;
            }

            .modal-header {
                padding: 24px;
            }

            .modal-body {
                padding: 24px;
            }

            .toast-container {
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .setting-item select {
                min-width: 100%;
            }

            .shortcut-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }

        @media (max-width: 480px) {
            .command-palette {
                border-radius: 16px;
            }

            .command-header {
                padding: 16px;
            }

            .command-item {
                padding: 14px 16px;
            }

            .command-category {
                padding: 12px 16px 6px;
            }

            .modal-content {
                border-radius: 20px;
            }

            .modal-header {
                padding: 20px;
            }

            .modal-body {
                padding: 20px;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            .command-palette {
                border-width: 2px;
            }

            .command-item.selected {
                border-width: 3px;
            }

            .toast {
                border-width: 2px;
            }

            .modal-content {
                border-width: 2px;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {

            .command-palette,
            .toast,
            .modal-content,
            .command-item,
            .shortcut-item,
            .search-result-item,
            .setting-item {
                transition: none;
                animation: none;
            }

            .command-item:hover,
            .command-item.selected {
                transform: none;
            }

            .modal-overlay {
                animation: none;
            }
        }
    </style>
    <style>
        .grid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.35;
            pointer-events: none;
            background: 
                linear-gradient(90deg, var(--border) 1px, transparent 1px) 0 0 / 60px 60px,
                linear-gradient(0deg, var(--border) 1px, transparent 1px) 0 0 / 60px 60px;
            will-change: transform;
        }

        .grid-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, var(--accent) 1px, transparent 1px),
                radial-gradient(circle at 80% 80%, var(--accent-secondary) 1px, transparent 1px);
            background-size: 120px 120px;
            opacity: 0.03;
        }

        .grid-background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(45deg, transparent 49.5%, var(--accent) 49.5%, var(--accent) 50.5%, transparent 50.5%) 0 0 / 40px 40px,
                linear-gradient(-45deg, transparent 49.5%, var(--accent-secondary) 49.5%, var(--accent-secondary) 50.5%, transparent 50.5%) 0 0 / 40px 40px;
            opacity: 0.02;
        }

        @keyframes grid-drift {
            0% {
                background-position: 0 0, 0 0;
                transform: translate3d(0, 0, 0);
            }
            100% {
                background-position: 60px 60px, 60px 60px;
                transform: translate3d(0, 0, 0);
            }
        }

        @keyframes grid-breathe {
            0%, 100% {
                opacity: 0.02;
                transform: scale3d(1, 1, 1);
            }
            50% {
                opacity: 0.05;
                transform: scale3d(1.01, 1.01, 1);
            }
        }

        @keyframes grid-shift {
            0% {
                background-position: 0 0, 0 0;
            }
            100% {
                background-position: 40px 40px, 40px 40px;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .grid-background,
            .grid-background::before,
            .grid-background::after {
                animation: none;
            }
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .grid-background {
                opacity: 0.35;
            }
        }
    </style>
    <style>
                .dashboard {
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Enhanced Header */
        .header {
            text-align: center;
            margin-bottom: 50px;
            padding: 50px 40px;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(30, 41, 59, 0.8) 100%);
            border: 1px solid var(--border);
            border-radius: 28px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--accent) 20%, 
                var(--accent-secondary) 50%,
                var(--accent) 80%, 
                transparent 100%);
            animation: shimmer 3s ease-in-out infinite;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            letter-spacing: -0.02em;
            position: relative;
            display: inline-block;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.3rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Enhanced Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 32px 28px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .stat-card:hover {
            transform: translateY(-12px) scale(1.02);
            border-color: var(--accent);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            opacity: 0.9;
            filter: drop-shadow(0 4px 12px rgba(96, 165, 250, 0.3));
        }

        .stat-value {
            font-size: 3.2rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .stat-label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            opacity: 0.8;
        }

        /* Advanced Charts Container */
        .charts-section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
            padding-left: 20px;
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            border-radius: 3px;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
            gap: 30px;
        }

        .chart-wrapper {
            background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 32px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .chart-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--accent) 50%, 
                transparent 100%);
        }

        .chart-title {
            font-size: 1.4rem;
            color: var(--text-primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 24px;
        }

        .chart-title i {
            color: var(--accent);
            font-size: 1.3em;
            background: rgba(96, 165, 250, 0.1);
            padding: 10px;
            border-radius: 12px;
        }

        /* Enhanced Tab System */
        .tab-container {
            background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid var(--border);
            border-radius: 28px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            margin-bottom: 50px;
        }

        .tab-header {
            display: flex;
            background: rgba(15, 23, 42, 0.8);
            border-bottom: 1px solid var(--border);
            position: relative;
            backdrop-filter: blur(10px);
        }

        .tab-button {
            flex: 1;
            padding: 24px 28px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .tab-button::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
            transition: width 0.4s ease;
            border-radius: 2px 2px 0 0;
        }

        .tab-button:hover {
            background: rgba(96, 165, 250, 0.05);
            color: var(--text-primary);
        }

        .tab-button.active {
            color: var(--accent);
            background: rgba(96, 165, 250, 0.1);
        }

        .tab-button.active::before {
            width: 80%;
        }

        .tab-content {
            padding: 40px;
            min-height: 600px;
        }

        .tab-pane {
            display: none;
            animation: fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab-pane.active {
            display: block;
        }

        /* Advanced Nodes Section */
        .nodes-section {
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .section-title-sm {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .section-count {
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
        }

        .nodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 16px;
        }

        .node-item {
            background: linear-gradient(145deg, var(--bg-tertiary), rgba(15, 23, 42, 0.8));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 22px 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .node-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            transform: scaleY(0);
            transition: transform 0.4s ease;
            border-radius: 0 3px 3px 0;
        }

        .node-item:hover {
            transform: translateX(12px) scale(1.02);
            border-color: var(--accent);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.25);
        }

        .node-item:hover::before {
            transform: scaleY(1);
        }

        .node-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 16px;
        }

        .node-info {
            flex: 1;
        }

        .node-name {
            color: var(--text-primary);
            font-weight: 600;
            line-height: 1.5;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .node-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .node-tag {
            background: rgba(96, 165, 250, 0.1);
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid rgba(96, 165, 250, 0.2);
        }

        .risk-badge {
            padding: 8px 16px;
            border-radius: 14px;
            font-size: 0.85rem;
            font-weight: 700;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .risk-high {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .risk-moderate {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: black;
        }

        .risk-low {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .risk-safe {
            background: linear-gradient(135deg, var(--info), #0891b2);
            color: white;
        }

        /* Advanced Path Visualization */
        .path-item {
            background: linear-gradient(145deg, var(--bg-tertiary), rgba(15, 23, 42, 0.8));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .path-item:hover {
            transform: translateY(-8px);
            border-color: var(--accent);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .path-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .path-title {
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
        }

        .path-metrics {
            display: flex;
            gap: 20px;
        }

        .path-metric {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 18px;
            border-radius: 14px;
            font-size: 0.95rem;
            font-weight: 600;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .path-nodes {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .path-node {
            background: var(--bg-secondary);
            padding: 12px 18px;
            border-radius: 14px;
            font-size: 0.9rem;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .path-node:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(96, 165, 250, 0.3);
        }

        .path-connector {
            color: var(--text-secondary);
            font-weight: 700;
            font-size: 1.2rem;
            margin: 0 8px;
        }

        /* Component Cards */
        .component-card {
            background: linear-gradient(145deg, var(--bg-tertiary), rgba(15, 23, 42, 0.8));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .component-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .component-title {
            color: var(--text-primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
        }

        .component-size {
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
        }

        .component-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .component-metric {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 14px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .component-metric:hover {
            background: rgba(96, 165, 250, 0.1);
            border-color: var(--accent);
        }

        .metric-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .metric-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Network Graph Visualization */
        .network-graph {
            width: 100%;
            height: 600px;
            background: var(--bg-secondary);
            border-radius: 20px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .graph-legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.9);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nodes-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-header {
                flex-direction: column;
            }
            
            .path-header {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            
            .path-metrics {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-value {
                font-size: 2.5rem;
            }
            
            .tab-content {
                padding: 20px;
            }
        }
        </style>
</head>

<body>
    <div class="grid-background"></div>    
    <!-- Backdrop -->
    <div class="backdrop" id="backdrop"></div>

    <div class="toast-container" id="toastContainer"></div>

    <!-- Command Palette -->
    <div class="command-palette" id="commandPalette">
        <div class="command-header">
            <i class="fas fa-search"></i>
            <input type="text" class="command-input" id="commandInput" placeholder="Search commands..." />
            <div class="command-shortcut">ESC</div>
        </div>
        <div class="command-list" id="commandList">
            <!-- Commands will be populated dynamically -->
        </div>
    </div>

    <div class="quick-actions" id="quickActions">
        <div class="quick-action" data-action="command">
            <i class="fas fa-terminal"></i>
            <span>Command</span>
        </div>
        <div class="quick-action" data-action="fullscreen">
            <i class="fas fa-expand"></i>
            <span>Fullscreen</span>
        </div>
        <div class="quick-action" data-action="help">
            <i class="fas fa-question-circle"></i>
            <span>Help</span>
        </div>
    </div>

    <div class="dashboard">
        <div class="stats-grid" id="statsGrid"></div>

        <!-- Advanced Charts Section -->
        <div class="charts-section">
            <div class="section-title">
                <i class="fas fa-chart-bar"></i>
                Distribution Analytics
            </div>
            <div class="charts-container">
                <div class="chart-wrapper">
                    <div class="chart-title">
                        <i class="fas fa-cubes"></i>
                        Resource Type Distribution
                    </div>
                    <canvas id="typeChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Risk Distribution Analysis
                    </div>
                    <canvas id="riskChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">
                        <i class="fas fa-brain"></i>
                        Complexity Metrics
                    </div>
                    <canvas id="complexityChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">
                        <i class="fas fa-sitemap"></i>
                        Node State Distribution
                    </div>
                    <canvas id="stateChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Enhanced Tab System -->
        <div class="tab-container">
            <div class="tab-header">
                <button class="tab-button active" onclick="switchTab('criticalNodes')">
                    <i class="fas fa-fire"></i>
                    Critical Nodes
                </button>
                <button class="tab-button" onclick="switchTab('paths')">
                    <i class="fas fa-route"></i>
                    Dependency Paths
                </button>
                <button class="tab-button" onclick="switchTab('components')">
                    <i class="fas fa-puzzle-piece"></i>
                    Components
                </button>
                <button class="tab-button" onclick="switchTab('network')">
                    <i class="fas fa-network-wired"></i>
                    Network Graph
                </button>
            </div>
            <div class="tab-content">
                <div id="criticalNodes" class="tab-pane active"></div>
                <div id="paths" class="tab-pane"></div>
                <div id="components" class="tab-pane"></div>
                <div id="network" class="tab-pane">
                    <div class="network-graph" id="networkGraph">
                        <div class="graph-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--accent);"></div>
                                <span>Hub Nodes</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--danger);"></div>
                                <span>High Risk</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--success);"></div>
                                <span>Safe Nodes</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--warning);"></div>
                                <span>Bottlenecks</span>
                            </div>
                        </div>
                        <canvas id="networkCanvas"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        class CommandPalette {
            constructor(rawData, options = {}) {
                this.config = {
                    enableBacktickKey: true,
                    searchDebounce: 150,
                    hotkeyModifier: 'ctrlKey',
                    ...options
                };

                this.backdrop = document.getElementById('backdrop');
                this.commandPalette = document.getElementById('commandPalette');
                this.commandInput = document.getElementById('commandInput');
                this.commandList = document.getElementById('commandList');
                this.toastContainer = document.getElementById('toastContainer');
                this.quickActions = document.getElementById('quickActions');

                if (!this.commandPalette || !this.backdrop || !this.commandInput || !this.commandList) {
                    console.error('Command palette essential elements not found in DOM');
                    this.showErrorToast('Command palette initialization failed: Missing DOM elements');
                    return;
                }

                this.selectedCommandIndex = 0;
                this.isOpen = false;
                this._debounceTimer = null;
                this.filteredCommands = [];
                this.isFullscreen = false;

                console.log(rawData)

                // Initialize data
                this.data = rawData
                // Initialize dashboard instance if it doesn't exist
                if (typeof window.dashboardInstance === 'undefined') {
                    window.dashboardInstance = this.createDashboardInstance();
                }

                this.commands = [
                    {
                        id: 'export-data',
                        title: 'Export Data',
                        description: 'Export all dashboard data as JSON',
                        icon: 'fas fa-download',
                        shortcut: 'Ctrl+E',
                        category: 'Data',
                        action: () => this.executeAction('export'),
                        keywords: ['export', 'download', 'save', 'json']
                    },
                    {
                        id: 'toggle-fullscreen',
                        title: 'Toggle Fullscreen',
                        description: 'Enter or exit fullscreen mode',
                        icon: 'fas fa-expand',
                        shortcut: 'F11',
                        category: 'View',
                        action: () => this.executeAction('fullscreen'),
                        keywords: ['fullscreen', 'full', 'screen', 'maximize']
                    },
                    {
                        id: 'show-help',
                        title: 'Show Help',
                        description: 'Display keyboard shortcuts and tips',
                        icon: 'fas fa-question-circle',
                        shortcut: 'F1',
                        category: 'Help',
                        action: () => this.executeAction('help'),
                        keywords: ['help', 'documentation', 'guide', 'tips']
                    },
                    {
                        id: 'search-data',
                        title: 'Search Data',
                        description: 'Search through your dashboard data',
                        icon: 'fas fa-search',
                        shortcut: 'Ctrl+F',
                        category: 'Data',
                        action: () => this.executeAction('search'),
                        keywords: ['search', 'find', 'query', 'filter']
                    },
                    {
                        id: 'settings',
                        title: 'Open Settings',
                        description: 'Configure application settings',
                        icon: 'fas fa-cog',
                        shortcut: 'Ctrl+,',
                        category: 'System',
                        action: () => this.executeAction('settings'),
                        keywords: ['settings', 'configure', 'preferences', 'options']
                    }
                ];

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupQuickActions();
                this.showSuccessToast('Command palette ready. Press Ctrl+K or ` to open.');
            }

            setupEventListeners() {
                document.addEventListener('keydown', this.handleKeyboard.bind(this));
                this.commandInput.addEventListener('input', this.debounceFilter.bind(this));
                this.commandInput.addEventListener('keydown', this.handleCommandNavigation.bind(this));
                this.backdrop.addEventListener('click', this.hideCommandPalette.bind(this));
                
                this.commandPalette.addEventListener('click', (e) => e.stopPropagation());
            }

            setupQuickActions() {
                if (!this.quickActions) return;

                this.quickActions.addEventListener('click', (e) => {
                    const actionButton = e.target.closest('.quick-action');
                    if (!actionButton) return;

                    const action = actionButton.dataset.action;
                    this.handleQuickAction(action);
                });
            }

            handleQuickAction(action) {
                switch (action) {
                    case 'command':
                        this.toggleCommandPalette();
                        break;
                    case 'fullscreen':
                        this.executeAction('fullscreen');
                        break;
                    case 'help':
                        this.executeAction('help');
                        break;
                }
            }

            handleKeyboard(event) {
                // Don't handle keyboard events when palette is open and user is typing
                if (this.isOpen && event.key !== 'Escape') {
                    return;
                }

                const isModifierPressed = this.checkModifierKey(event);

                switch (event.key) {
                    case 'Escape':
                        if (this.isOpen) {
                            event.preventDefault();
                            this.hideCommandPalette();
                        }
                        break;

                    case 'F1':
                        event.preventDefault();
                        this.executeAction('help');
                        break;

                    case 'F11':
                        event.preventDefault();
                        this.executeAction('fullscreen');
                        break;

                    case 'k':
                        if (isModifierPressed) {
                            event.preventDefault();
                            this.toggleCommandPalette();
                        }
                        break;

                    case '`':
                        if (this.config.enableBacktickKey && !event.ctrlKey && !event.metaKey && !event.altKey) {
                            event.preventDefault();
                            this.toggleCommandPalette();
                        }
                        break;

                    case 'e':
                        if (isModifierPressed) {
                            event.preventDefault();
                            this.executeAction('export');
                        }
                        break;

                    case 'f':
                        if (isModifierPressed) {
                            event.preventDefault();
                            this.executeAction('search');
                        }
                        break;

                    case ',':
                        if (isModifierPressed) {
                            event.preventDefault();
                            this.executeAction('settings');
                        }
                        break;
                }
            }

            checkModifierKey(event) {
                switch (this.config.hotkeyModifier) {
                    case 'ctrlKey':
                        return event.ctrlKey && !event.metaKey;
                    case 'metaKey':
                        return event.metaKey && !event.ctrlKey;
                    case 'both':
                        return event.ctrlKey || event.metaKey;
                    default:
                        return event.ctrlKey || event.metaKey;
                }
            }

            toggleCommandPalette() {
                this.isOpen ? this.hideCommandPalette() : this.showCommandPalette();
            }

            showCommandPalette() {
                if (this.isOpen) return;
                
                this.isOpen = true;
                document.body.style.overflow = 'hidden';

                this.backdrop.classList.add('show');
                this.commandPalette.classList.add('show');
                this.commandInput.value = '';
                this.selectedCommandIndex = 0;

                // Force reflow for animation
                this.commandPalette.offsetHeight;

                requestAnimationFrame(() => {
                    this.commandInput.focus();
                    this.filterCommands();
                });
            }

            hideCommandPalette() {
                if (!this.isOpen) return;
                
                this.isOpen = false;
                document.body.style.overflow = '';

                // Add closing animation
                this.commandPalette.style.transform = 'translateX(-50%) scale(0.95)';
                this.commandPalette.style.opacity = '0';
                
                setTimeout(() => {
                    this.backdrop.classList.remove('show');
                    this.commandPalette.classList.remove('show');
                    this.commandInput.value = '';
                    this.selectedCommandIndex = 0;
                    this.filteredCommands = [];
                    
                    // Reset transforms
                    this.commandPalette.style.transform = '';
                    this.commandPalette.style.opacity = '';
                }, 200);
            }

            debounceFilter() {
                clearTimeout(this._debounceTimer);
                this._debounceTimer = setTimeout(() => {
                    this.filterCommands();
                }, this.config.searchDebounce);
            }

            filterCommands() {
                const query = this.commandInput.value.toLowerCase().trim();
                
                this.filteredCommands = query === '' ? this.commands : this.commands.filter(cmd =>
                    cmd.title.toLowerCase().includes(query) ||
                    cmd.description.toLowerCase().includes(query) ||
                    (cmd.keywords && cmd.keywords.some(keyword => 
                        keyword.toLowerCase().includes(query)
                    )) ||
                    cmd.category.toLowerCase().includes(query)
                );

                this.renderCommands(this.filteredCommands);
            }

            renderCommands(commands) {
                this.commandList.innerHTML = '';
                this.selectedCommandIndex = 0;
                this.filteredCommands = commands;

                if (commands.length === 0) {
                    this.commandList.innerHTML = `
                        <div class="command-empty-state">
                            <i class="fas fa-search"></i>
                            <div>No commands found</div>
                            <div class="command-empty-hint">Try different keywords</div>
                        </div>
                    `;
                    return;
                }

                const groupedCommands = this.groupByCategory(commands);
                let itemIndex = 0; // Track the actual DOM index
                
                Object.keys(groupedCommands).forEach(category => {
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'command-category';
                    categoryHeader.textContent = category;
                    this.commandList.appendChild(categoryHeader);

                    groupedCommands[category].forEach((command) => {
                        const item = document.createElement('div');
                        item.className = `command-item ${itemIndex === 0 ? 'selected' : ''}`;
                        item.setAttribute('role', 'option');
                        item.setAttribute('aria-selected', itemIndex === 0);
                        item.setAttribute('data-index', itemIndex);
                        
                        item.innerHTML = `
                            <div class="command-icon">
                                <i class="${command.icon}"></i>
                            </div>
                            <div class="command-content">
                                <div class="command-title">${this.highlightText(command.title, this.commandInput.value)}</div>
                                <div class="command-description">${command.description}</div>
                            </div>
                            <div class="command-shortcut-item">${command.shortcut}</div>
                        `;

                        item.addEventListener('click', () => this.executeCommand(command));
                        item.addEventListener('mouseenter', () => {
                            this.selectedCommandIndex = itemIndex;
                            this.updateSelection();
                        });

                        this.commandList.appendChild(item);
                        itemIndex++;
                    });
                });
            }

            groupByCategory(commands) {
                return commands.reduce((groups, command) => {
                    const category = command.category || 'General';
                    if (!groups[category]) groups[category] = [];
                    groups[category].push(command);
                    return groups;
                }, {});
            }

            highlightText(text, query) {
                if (!query.trim()) return text;
                const regex = new RegExp(`(${this.escapeRegex(query)})`, 'gi');
                return text.replace(regex, '<mark>$1</mark>');
            }

            escapeRegex(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            handleCommandNavigation(event) {
                const items = this.commandList.querySelectorAll('.command-item');
                if (items.length === 0) return;

                switch (event.key) {
                    case 'ArrowDown':
                        event.preventDefault();
                        this.selectedCommandIndex = Math.min(this.selectedCommandIndex + 1, items.length - 1);
                        this.updateSelection();
                        break;
                    case 'ArrowUp':
                        event.preventDefault();
                        this.selectedCommandIndex = Math.max(this.selectedCommandIndex - 1, 0);
                        this.updateSelection();
                        break;
                    case 'Enter':
                        event.preventDefault();
                        const selectedCommand = this.filteredCommands[this.selectedCommandIndex];
                        if (selectedCommand) {
                            this.executeCommand(selectedCommand);
                        }
                        break;
                    case 'Tab':
                        event.preventDefault();
                        if (event.shiftKey) {
                            this.selectedCommandIndex = Math.max(this.selectedCommandIndex - 1, 0);
                        } else {
                            this.selectedCommandIndex = Math.min(this.selectedCommandIndex + 1, items.length - 1);
                        }
                        this.updateSelection();
                        break;
                }
            }

            updateSelection() {
                const items = this.commandList.querySelectorAll('.command-item');
                items.forEach((item, index) => {
                    const isSelected = index === this.selectedCommandIndex;
                    item.classList.toggle('selected', isSelected);
                    item.setAttribute('aria-selected', isSelected);
                });

                const selectedItem = items[this.selectedCommandIndex];
                if (selectedItem) {
                    selectedItem.scrollIntoView({ 
                        block: 'nearest', 
                        behavior: 'smooth',
                        inline: 'nearest'
                    });
                }
            }

            executeCommand(command) {
                try {
                    command.action();
                    this.showSuccessToast(`Executed: ${command.title}`);
                    this.hideCommandPalette();
                } catch (error) {
                    console.error('Error executing command:', error);
                    this.showErrorToast(`Failed to execute: ${command.title}`);
                }
            }

            executeAction(action) {
                if (typeof window.dashboardInstance === 'undefined') {
                    this.showErrorToast('Dashboard instance not available');
                    return;
                }

                const actionMap = {
                    'export': 'exportData',
                    'fullscreen': 'toggleFullscreen',
                    'help': 'showHelp',
                    'search': 'showSearch',
                    'settings': 'showSettings'
                };

                const methodName = actionMap[action];
                if (methodName && typeof window.dashboardInstance[methodName] === 'function') {
                    try {
                        const result = window.dashboardInstance[methodName]();
                        
                        // Handle async actions
                        if (result instanceof Promise) {
                            this.showLoadingToast(`Processing ${action}...`);
                            result.then(message => {
                                this.showSuccessToast(message || `Action completed: ${action}`);
                            }).catch(error => {
                                console.error(`Error executing ${action}:`, error);
                                this.showErrorToast(`Failed to execute: ${action}`);
                            });
                        } else {
                            this.showSuccessToast(result || `Action completed: ${action}`);
                        }
                    } catch (error) {
                        console.error(`Error executing ${action}:`, error);
                        this.showErrorToast(`Failed to execute: ${action}`);
                    }
                } else {
                    this.showErrorToast(`Action not available: ${action}`);
                }
            }

            createDashboardInstance() {
                return {
                    exportData: () => {
                        const dataStr = JSON.stringify(this.data, null, 2);
                        const dataBlob = new Blob([dataStr], { type: 'application/json' });
                        
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(dataBlob);
                        link.download = `analytics-export-${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(link.href);
                        
                        return `Exported analytics data`;
                    },

                    toggleFullscreen: () => {
                        if (!document.fullscreenElement) {
                            document.documentElement.requestFullscreen().catch(err => {
                                console.error('Error attempting to enable fullscreen:', err);
                            });
                            this.isFullscreen = true;
                            return 'Entered fullscreen mode';
                        } else {
                            document.exitFullscreen();
                            this.isFullscreen = false;
                            return 'Exited fullscreen mode';
                        }
                    },

                    showHelp: () => {
                        const helpContent = `
                            <div class="help-modal">
                                <h3>Keyboard Shortcuts</h3>
                                <div class="shortcut-list">
                                    <div class="shortcut-item">
                                        <span class="keys"><kbd>Ctrl</kbd> + <kbd>K</kbd></span>
                                        <span class="description">Open Command Palette</span>
                                    </div>
                                    <div class="shortcut-item">
                                        <span class="keys"><kbd>Ctrl</kbd> + <kbd>E</kbd></span>
                                        <span class="description">Export Data</span>
                                    </div>
                                    <div class="shortcut-item">
                                        <span class="keys"><kbd>F11</kbd></span>
                                        <span class="description">Toggle Fullscreen</span>
                                    </div>
                                    <div class="shortcut-item">
                                        <span class="keys"><kbd>Ctrl</kbd> + <kbd>F</kbd></span>
                                        <span class="description">Search Data</span>
                                    </div>
                                    <div class="shortcut-item">
                                        <span class="keys"><kbd>Ctrl</kbd> + <kbd>,</kbd></span>
                                        <span class="description">Open Settings</span>
                                    </div>
                                    <div class="shortcut-item">
                                        <span class="keys"><kbd>F1</kbd></span>
                                        <span class="description">Show Help</span>
                                    </div>
                                </div>
                            </div>
                        `;

                        this.showModal('Help & Shortcuts', helpContent);
                        return 'Help dialog opened';
                    },

                    showSearch: () => {
                        const searchHTML = `
                            <div class="search-modal">
                                <input type="text" id="globalSearch" placeholder="Search nodes, types, risks, components..." class="search-input">
                                <div id="searchResults" class="search-results"></div>
                            </div>
                        `;

                        this.showModal('Search Analytics Data', searchHTML, () => {
                            const searchInput = document.getElementById('globalSearch');
                            const searchResults = document.getElementById('searchResults');
                            
                            searchInput.focus();
                            
                            // Perform initial empty search to show placeholder
                            this.performSearch('', searchResults);
                            
                            searchInput.addEventListener('input', (e) => {
                                this.performSearch(e.target.value, searchResults);
                            });
                        });
                        
                        return 'Search dialog opened';
                    },

                    showSettings: () => {
                        const settingsHTML = `
                            <div class="settings-modal">
                                <div class="setting-group">
                                    <h4>Appearance</h4>
                                    <div class="setting-item">
                                        <label>Theme:</label>
                                        <select id="themeSelect">
                                            <option value="light">Light</option>
                                            <option value="dark" selected>Dark</option>
                                            <option value="auto">Auto</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" id="notificationsToggle" checked>
                                            Enable Notifications
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-group">
                                    <h4>Behavior</h4>
                                    <div class="setting-item">
                                        <label>Command Palette Hotkey:</label>
                                        <select id="hotkeySelect">
                                            <option value="ctrlKey">Ctrl+K</option>
                                            <option value="metaKey">Cmd+K</option>
                                            <option value="both">Both</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <label>
                                            <input type="checkbox" id="backtickToggle" checked>
                                            Enable Backtick (` + '`' + `) Key
                                        </label>
                                    </div>
                                </div>
                            </div>
                        `;

                        this.showModal('Settings', settingsHTML, () => {
                            // Initialize settings values
                            document.getElementById('themeSelect').value = this.data.settings.theme;
                            document.getElementById('notificationsToggle').checked = this.data.settings.notifications;
                            document.getElementById('hotkeySelect').value = this.config.hotkeyModifier;
                            document.getElementById('backtickToggle').checked = this.config.enableBacktickKey;

                            // Add event listeners
                            document.getElementById('themeSelect').addEventListener('change', (e) => {
                                this.data.settings.theme = e.target.value;
                                this.applyTheme(e.target.value);
                            });

                            document.getElementById('notificationsToggle').addEventListener('change', (e) => {
                                this.data.settings.notifications = e.target.checked;
                                this.showSuccessToast(`Notifications ${e.target.checked ? 'enabled' : 'disabled'}`);
                            });

                            document.getElementById('hotkeySelect').addEventListener('change', (e) => {
                                this.config.hotkeyModifier = e.target.value;
                                this.showSuccessToast(`Hotkey preference updated`);
                            });

                            document.getElementById('backtickToggle').addEventListener('change', (e) => {
                                this.config.enableBacktickKey = e.target.checked;
                                this.showSuccessToast(`Backtick key ${e.target.checked ? 'enabled' : 'disabled'}`);
                            });
                        });
                        
                        return 'Settings dialog opened';
                    }
                };
            }

            performSearch(query, resultsContainer) {
                if (!query.trim()) {
                    resultsContainer.innerHTML = '<div class="no-results">Enter search terms to find data</div>';
                    return;
                }

                const searchTerm = query.toLowerCase();
                const allResults = [];

                if (this.data) {
                    if (this.data.node_metrics) {
                        Object.keys(this.data.node_metrics).forEach(nodeId => {
                            if (nodeId.toLowerCase().includes(searchTerm)) {
                                const node = this.data.node_metrics[nodeId];
                                allResults.push({
                                    type: 'Node',
                                    title: nodeId,
                                    subtitle: `Type: ${this.getNodeType(nodeId)} | Risk: ${node.risk_level || 'unknown'}`,
                                    icon: 'fas fa-sitemap',
                                    data: node
                                });
                            }
                        });
                    }

                    if (this.data.hub_nodes) {
                        this.data.hub_nodes.forEach(node => {
                            if (node.toLowerCase().includes(searchTerm)) {
                                allResults.push({
                                    type: 'Hub Node',
                                    title: node,
                                    subtitle: 'Highly connected central node',
                                    icon: 'fas fa-hub',
                                    data: { node }
                                });
                            }
                        });
                    }

                    if (this.data.bottleneck_nodes) {
                        this.data.bottleneck_nodes.forEach(node => {
                            if (node.toLowerCase().includes(searchTerm)) {
                                allResults.push({
                                    type: 'Bottleneck',
                                    title: node,
                                    subtitle: 'Critical performance bottleneck',
                                    icon: 'fas fa-hourglass-half',
                                    data: { node }
                                });
                            }
                        });
                    }

                    if (this.data.high_risk_nodes) {
                        this.data.high_risk_nodes.forEach(([node, score]) => {
                            if (node.toLowerCase().includes(searchTerm)) {
                                allResults.push({
                                    type: 'High Risk',
                                    title: node,
                                    subtitle: `Risk Score: ${score.toFixed(1)}`,
                                    icon: 'fas fa-exclamation-triangle',
                                    data: { node, score }
                                });
                            }
                        });
                    }

                    if (this.data.components) {
                        Object.entries(this.data.components).forEach(([id, component]) => {
                            if (id.toLowerCase().includes(searchTerm) || 
                                component.component_type?.toLowerCase().includes(searchTerm)) {
                                allResults.push({
                                    type: 'Component',
                                    title: `Component ${id}`,
                                    subtitle: `Size: ${component.size} nodes | Type: ${component.component_type}`,
                                    icon: 'fas fa-puzzle-piece',
                                    data: component
                                });
                            }
                        });
                    }

                    if (this.data.risk_distribution) {
                        Object.keys(this.data.risk_distribution).forEach(riskLevel => {
                            if (riskLevel.toLowerCase().includes(searchTerm)) {
                                allResults.push({
                                    type: 'Risk Level',
                                    title: `${riskLevel} Risk`,
                                    subtitle: `${this.data.risk_distribution[riskLevel]} nodes`,
                                    icon: 'fas fa-shield-alt',
                                    data: { riskLevel, count: this.data.risk_distribution[riskLevel] }
                                });
                            }
                        });
                    }

                    if (this.data.type_distribution) {
                        Object.keys(this.data.type_distribution).forEach(nodeType => {
                            if (nodeType.toLowerCase().includes(searchTerm)) {
                                allResults.push({
                                    type: 'Node Type',
                                    title: `${nodeType} Nodes`,
                                    subtitle: `${this.data.type_distribution[nodeType]} total`,
                                    icon: 'fas fa-tag',
                                    data: { nodeType, count: this.data.type_distribution[nodeType] }
                                });
                            }
                        });
                    }
                }

                if (allResults.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-search"></i>
                            <div>No results found for "${query}"</div>
                        </div>
                    `;
                } else {
                    resultsContainer.innerHTML = allResults.map(result => `
                        <div class="search-result-item" data-type="${result.type}">
                            <div class="result-icon">
                                <i class="${result.icon}"></i>
                            </div>
                            <div class="result-content">
                                <div class="result-title">${result.title}</div>
                                <div class="result-subtitle">${result.subtitle}</div>
                                <div class="result-type">${result.type}</div>
                            </div>
                        </div>
                    `).join('');
                }
            }

            getNodeType(nodeId) {
                if (nodeId.startsWith('var.')) return 'Variable';
                if (nodeId.startsWith('local.')) return 'Local';
                if (nodeId.startsWith('output.')) return 'Output';
                if (nodeId.startsWith('data.')) return 'Data Source';
                if (nodeId.startsWith('module.')) return 'Module';
                if (nodeId.includes('aws_')) return 'AWS Resource';
                if (nodeId.includes('google_')) return 'Google Resource';
                if (nodeId.includes('azure_')) return 'Azure Resource';
                return 'Resource';
            }

            applyTheme(theme) {
                document.body.setAttribute('data-theme', theme);
                this.showSuccessToast(`Theme changed to ${theme}`);
            }

            showModal(title, content, onOpen = null) {
                // Remove existing modal if any
                const existingModal = document.getElementById('commandModal');
                if (existingModal) {
                    existingModal.remove();
                }

                const modal = document.createElement('div');
                modal.id = 'commandModal';
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>${title}</h3>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Add event listeners with better handling
                const closeModal = () => {
                    modal.style.opacity = '0';
                    modal.style.backdropFilter = 'blur(0px)';
                    modal.querySelector('.modal-content').style.transform = 'scale(0.9) translateY(20px)';
                    
                    setTimeout(() => {
                        if (modal.parentNode) {
                            modal.parentNode.removeChild(modal);
                        }
                    }, 300);
                };

                modal.querySelector('.modal-close').addEventListener('click', closeModal);

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                });

                // Escape key to close
                const handleEscape = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        document.removeEventListener('keydown', handleEscape);
                    }
                };
                document.addEventListener('keydown', handleEscape);

                // Call onOpen callback if provided
                if (onOpen && typeof onOpen === 'function') {
                    setTimeout(onOpen, 50);
                }
            }

            showSuccessToast(message) {
                this.showToast(message, 'success');
            }

            showErrorToast(message) {
                this.showToast(message, 'error');
            }

            showLoadingToast(message) {
                this.showToast(message, 'loading');
            }

            showToast(message, type = 'info') {
                if (!this.toastContainer) {
                    console.log(`[${type.toUpperCase()}] ${message}`);
                    return;
                }

                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                
                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-circle',
                    loading: 'spinner fa-spin',
                    info: 'info-circle'
                };

                toast.innerHTML = `
                    <div class="toast-content">
                        <i class="fas fa-${icons[type]}"></i>
                        <span>${message}</span>
                    </div>
                `;

                this.toastContainer.appendChild(toast);

                // Trigger animation
                setTimeout(() => toast.classList.add('show'), 10);

                // Auto-remove after 3 seconds (except loading toasts)
                if (type !== 'loading') {
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.classList.remove('show');
                            setTimeout(() => {
                                if (toast.parentNode) {
                                    toast.parentNode.removeChild(toast);
                                }
                            }, 300);
                        }
                    }, 3000);
                }

                return toast;
            }

            addCommand(command) {
                if (!command.id || !command.title || !command.action) {
                    console.error('Invalid command structure');
                    return;
                }
                
                this.commands.push({
                    category: 'Custom',
                    keywords: [],
                    ...command
                });
            }

            removeCommand(commandId) {
                this.commands = this.commands.filter(cmd => cmd.id !== commandId);
            }

            updateConfig(newConfig) {
                this.config = { ...this.config, ...newConfig };
            }
        }
    </script>
    <script>
    </script>
    <script>
        class AnalyticsManager {
            constructor(data) {
                this.data = data;
                this.charts = new Map();
                this.currentTheme = this.getThemeColors();
                this.init();
            }

            getThemeColors() {
                const style = getComputedStyle(document.documentElement);
                return {
                    bgPrimary: style.getPropertyValue('--bg-primary').trim(),
                    bgSecondary: style.getPropertyValue('--bg-secondary').trim(),
                    bgTertiary: style.getPropertyValue('--bg-tertiary').trim(),
                    textPrimary: style.getPropertyValue('--text-primary').trim(),
                    textSecondary: style.getPropertyValue('--text-secondary').trim(),
                    accent: style.getPropertyValue('--accent').trim(),
                    accentSecondary: style.getPropertyValue('--accent-secondary').trim(),
                    success: style.getPropertyValue('--success').trim(),
                    warning: style.getPropertyValue('--warning').trim(),
                    danger: style.getPropertyValue('--danger').trim(),
                    info: style.getPropertyValue('--info').trim(),
                    border: style.getPropertyValue('--border').trim()
                };
            }

            init() {
                this.renderStats();
                this.createCharts();
                this.renderCriticalNodes();
                this.renderLongestPaths();
                this.renderComponents();
                this.createNetworkGraph();
            }

            renderStats() {
                const stats = [
                    { 
                        label: 'Total Nodes', 
                        value: this.data.total_nodes, 
                        icon: 'fas fa-cube'
                    },
                    { 
                        label: 'Total Edges', 
                        value: this.data.total_edges, 
                        icon: 'fas fa-link'
                    },
                    { 
                        label: 'Components', 
                        value: this.data.total_components, 
                        icon: 'fas fa-puzzle-piece'
                    },
                    { 
                        label: 'Graph Density', 
                        value: this.data.graph_density.toFixed(4), 
                        icon: 'fas fa-chart-network'
                    },
                    { 
                        label: 'Network Diameter', 
                        value: this.data.diameter, 
                        icon: 'fas fa-arrows-alt-h'
                    },
                    { 
                        label: 'Technical Debt', 
                        value: `${this.data.technical_debt_score.toFixed(1)}%`, 
                        icon: 'fas fa-coins'
                    },
                    { 
                        label: 'Maintainability', 
                        value: `${this.data.maintainability_index.toFixed(1)}%`, 
                        icon: 'fas fa-tools'
                    },
                    { 
                        label: 'Max In Degree', 
                        value: this.data.max_in_degree, 
                        icon: 'fas fa-arrow-down'
                    }
                ];

                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = stats.map(stat => `
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="${stat.icon}"></i>
                        </div>
                        <div class="stat-value">${stat.value}</div>
                        <div class="stat-label">${stat.label}</div>
                    </div>
                `).join('');
            }

            createCharts() {
                this.createTypeChart();
                this.createRiskChart();
                this.createComplexityChart();
                this.createStateChart();
            }

            createTypeChart() {
                const ctx = document.getElementById('typeChart').getContext('2d');
                const typeData = this.data.type_distribution;
                
                this.createAdvancedPieChart(ctx, 'Type Distribution', typeData, [
                    this.currentTheme.accent,
                    this.currentTheme.success,
                    this.currentTheme.warning,
                    this.currentTheme.danger,
                    this.currentTheme.accentSecondary,
                    this.currentTheme.info,
                    '#2dd4bf',
                    '#fb923c'
                ]);
            }

            createRiskChart() {
                const ctx = document.getElementById('riskChart').getContext('2d');
                const riskData = this.data.risk_distribution;
                
                this.createAdvancedPieChart(ctx, 'Risk Distribution', riskData, [
                    this.currentTheme.danger,
                    this.currentTheme.success,
                    this.currentTheme.warning,
                    this.currentTheme.accentSecondary
                ]);
            }

            createComplexityChart() {
                const ctx = document.getElementById('complexityChart').getContext('2d');
                const complexityData = this.data.complexity_distribution;
                
                this.createAdvancedPieChart(ctx, 'Complexity Distribution', complexityData, [
                    this.currentTheme.success,
                    '#34d399',
                    this.currentTheme.warning,
                    this.currentTheme.danger
                ]);
            }

            createStateChart() {
                const ctx = document.getElementById('stateChart').getContext('2d');
                const stateData = this.data.state_distribution;
                
                this.createAdvancedPieChart(ctx, 'State Distribution', stateData, [
                    this.currentTheme.accent,
                    this.currentTheme.accentSecondary,
                    '#f472b6',
                    this.currentTheme.warning,
                    this.currentTheme.danger,
                    this.currentTheme.success,
                    '#2dd4bf'
                ]);
            }

            createAdvancedPieChart(ctx, title, data, colors) {
                if (this.charts.has(title)) {
                    this.charts.get(title).destroy();
                }

                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                
                const container = ctx.canvas.parentElement;
                ctx.canvas.style.width = '100%';
                ctx.canvas.style.height = '300px'; // Fixed height
                ctx.canvas.width = container.clientWidth;
                ctx.canvas.height = 300;

                const chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            data: Object.values(data),
                            backgroundColor: colors,
                            borderColor: this.currentTheme.bgSecondary,
                            borderWidth: 3,
                            borderRadius: 8,
                            spacing: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: {
                            padding: {
                                top: 10,
                                bottom: 10,
                                left: 10,
                                right: 10
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: this.currentTheme.textPrimary,
                                    font: {
                                        size: 11,
                                        family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                                    },
                                    padding: 15,
                                    usePointStyle: true,
                                    boxWidth: 12
                                }
                            },
                            tooltip: {
                                enabled: true,
                                position: 'nearest'
                            }
                        },
                        cutout: '65%',
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 800,
                            easing: 'easeOutQuart'
                        },
                        onResize: (chart, size) => {
                            if (size.height > 350) {
                                chart.options.maintainAspectRatio = true;
                                chart.update('none');
                            }
                        }
                    }
                });

                this.charts.set(title, chart);
            }
            renderCriticalNodes() {
                const container = document.getElementById('criticalNodes');
                
                const sections = [
                    {
                        title: ' High Risk Nodes',
                        icon: 'fas fa-fire',
                        nodes: this.data.high_risk_nodes,
                        getRiskClass: (risk) => risk > 15 ? 'high-risk' : risk > 10 ? 'moderate-risk' : 'low-risk'
                    },
                    {
                        title: ' Hub Nodes',
                        icon: 'fas fa-hubspot',
                        nodes: this.data.hub_nodes
                    },
                    {
                        title: ' Bottleneck Nodes',
                        icon: 'fas fa-tachometer-alt',
                        nodes: this.data.bottleneck_nodes
                    },
                    {
                        title: ' Bridge Nodes',
                        icon: 'fas fa-bridge',
                        nodes: this.data.bridge_nodes
                    },
                    {
                        title: ' Authority Nodes',
                        icon: 'fas fa-crown',
                        nodes: this.data.authority_nodes
                    },
                    {
                        title: ' Leaf Nodes',
                        icon: 'fas fa-leaf',
                        nodes: this.data.leaf_nodes
                    }
                ];

                container.innerHTML = sections.map(section => `
                    <div class="nodes-section">
                        <div class="section-header">
                            <div class="section-title-sm">
                                <i class="${section.icon}"></i>
                                ${section.title}
                            </div>
                            <div class="section-count">${section.nodes.length}</div>
                        </div>
                        <div class="nodes-grid">
                            ${this.renderNodeList(section.nodes, section.getRiskClass)}
                        </div>
                    </div>
                `).join('');
            }

            renderNodeList(nodes, riskClassFn) {
                if (!nodes || nodes.length === 0) {
                    return '<div class="node-item">No nodes found</div>';
                }

                const displayNodes = nodes.slice(0, 20);

                return displayNodes.map(node => {
                    const nodeName = Array.isArray(node) ? node[0] : node;
                    const riskScore = Array.isArray(node) ? node[1] : null;
                    
                    let riskBadge = '';
                    let additionalClass = '';
                    
                    if (riskScore !== null) {
                        additionalClass = riskClassFn ? riskClassFn(riskScore) : '';
                        riskBadge = `<div class="risk-badge ${
                            riskScore > 15 ? 'risk-high' : 
                            riskScore > 10 ? 'risk-moderate' : 
                            riskScore > 5 ? 'risk-low' : 'risk-safe'
                        }">${riskScore}</div>`;
                    }

                    const nodeType = this.getNodeType(nodeName);
                    const nodeTags = this.getNodeTags(nodeName, nodeType);

                    return `
                        <div class="node-item ${additionalClass}">
                            <div class="node-content">
                                <div class="node-info">
                                    <div class="node-name">${this.formatNodeName(nodeName)}</div>
                                    <div class="node-meta">
                                        ${nodeTags.map(tag => `<span class="node-tag">${tag}</span>`).join('')}
                                    </div>
                                </div>
                                ${riskBadge}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            getNodeType(nodeName) {
                if (nodeName.startsWith('var.')) return 'variable';
                if (nodeName.startsWith('local.')) return 'local';
                if (nodeName.startsWith('aws.')) return 'resource';
                if (nodeName.startsWith('output.')) return 'output';
                if (nodeName.startsWith('data.')) return 'data';
                if (nodeName.startsWith('module.')) return 'module';
                return 'other';
            }

            getNodeTags(nodeName, nodeType) {
                const tags = [nodeType];
                
                // Add additional tags based on node properties
                if (this.data.hub_nodes.includes(nodeName)) tags.push('hub');
                if (this.data.bottleneck_nodes.includes(nodeName)) tags.push('bottleneck');
                if (this.data.bridge_nodes.includes(nodeName)) tags.push('bridge');
                if (this.data.authority_nodes.includes(nodeName)) tags.push('authority');
                if (this.data.leaf_nodes.includes(nodeName)) tags.push('leaf');
                
                return tags.slice(0, 3);
            }

            formatNodeName(name) {
                if (name.length > 50) {
                    return name.substring(0, 47) + '...';
                }
                return name;
            }

            renderLongestPaths() {
                const container = document.getElementById('paths');
                const paths = this.data.longest_paths.slice(0, 8);

                container.innerHTML = paths.map((path, index) => `
                    <div class="path-item">
                        <div class="path-header">
                            <div class="path-title">
                                <i class="fas fa-route"></i>
                                Path ${index + 1}
                            </div>
                            <div class="path-metrics">
                                <div class="path-metric">
                                    <i class="fas fa-ruler"></i>
                                    Length: ${path.length}
                                </div>
                                <div class="path-metric">
                                    <i class="fas fa-weight-hanging"></i>
                                    Risk: ${path.risk_level}
                                </div>
                                <div class="path-metric">
                                    <i class="fas fa-chart-line"></i>
                                    Score: ${path.risk_score}
                                </div>
                            </div>
                        </div>
                        <div class="path-nodes">
                            ${path.path.map((node, i) => `
                                <div class="path-node">${this.formatNodeName(node)}</div>
                                ${i < path.path.length - 1 ? '<div class="path-connector"></div>' : ''}
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            renderComponents() {
                const container = document.getElementById('components');
                const components = Object.values(this.data.components);

                container.innerHTML = components.map(component => `
                    <div class="component-card">
                        <div class="component-header">
                            <div class="component-title">
                                <i class="fas fa-puzzle-piece"></i>
                                Component ${component.component_id}
                            </div>
                            <div class="component-size">${component.size} nodes</div>
                        </div>
                        <div class="component-metrics">
                            <div class="component-metric">
                                <div class="metric-label">Type</div>
                                <div class="metric-value">${component.component_type}</div>
                            </div>
                            <div class="component-metric">
                                <div class="metric-label">Density</div>
                                <div class="metric-value">${component.density.toFixed(3)}</div>
                            </div>
                            <div class="component-metric">
                                <div class="metric-label">Edges</div>
                                <div class="metric-value">${component.edge_count}</div>
                            </div>
                            <div class="component-metric">
                                <div class="metric-label">Diameter</div>
                                <div class="metric-value">${component.diameter}</div>
                            </div>
                        </div>
                        <div style="margin-top: 16px;">
                            <div class="metric-label">Node Types</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                                ${Object.entries(component.node_type_distribution)
                                    .map(([type, count]) => `
                                        <span class="node-tag">${type}: ${count}</span>
                                    `).join('')}
                            </div>
                        </div>
                        ${component.articulation_points && component.articulation_points.length > 0 ? `
                            <div style="margin-top: 16px;">
                                <div class="metric-label">Critical Points</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 8px;">
                                    ${component.articulation_points.slice(0, 3).map(p => this.formatNodeName(p)).join(', ')}
                                    ${component.articulation_points.length > 3 ? `... and ${component.articulation_points.length - 3} more` : ''}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            }

            createNetworkGraph() {
                const canvas = document.getElementById('networkCanvas');
                const ctx = canvas.getContext('2d');
                const container = document.getElementById('networkGraph');
                
                // Set canvas size
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;

                // Simple network visualization
                this.drawSimpleNetwork(ctx, canvas.width, canvas.height);
            }

            drawSimpleNetwork(ctx, width, height) {
                // Clear canvas
                ctx.fillStyle = this.currentTheme.bgSecondary;
                ctx.fillRect(0, 0, width, height);

                // Draw a simplified network representation
                const centerX = width / 2;
                const centerY = height / 2;
                const radius = Math.min(width, height) * 0.4;

                // Draw main component
                this.drawComponent(ctx, centerX, centerY, radius, 'Main Component', this.data.largest_component_size);

                // Draw smaller component
                this.drawComponent(ctx, centerX - 200, centerY - 150, radius * 0.3, 'Component 0', 2);

                // Draw connections
                ctx.strokeStyle = this.currentTheme.accent + '80';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(centerX - radius * 0.8, centerY);
                ctx.lineTo(centerX - 200 + radius * 0.3, centerY - 150);
                ctx.stroke();
                ctx.setLineDash([]);

                // Add statistics text
                ctx.fillStyle = this.currentTheme.textPrimary;
                ctx.font = '16px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText(`Total Nodes: ${this.data.total_nodes} | Edges: ${this.data.total_edges} | Components: ${this.data.total_components}`, centerX, height - 30);
            }

            drawComponent(ctx, x, y, radius, label, size) {
                // Draw component circle
                ctx.fillStyle = this.currentTheme.bgTertiary + '80';
                ctx.strokeStyle = this.currentTheme.accent;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();

                // Draw inner nodes
                const nodeCount = Math.min(size, 12);
                for (let i = 0; i < nodeCount; i++) {
                    const angle = (i / nodeCount) * 2 * Math.PI;
                    const nodeX = x + Math.cos(angle) * (radius * 0.6);
                    const nodeY = y + Math.sin(angle) * (radius * 0.6);
                    
                    // Determine node color based on type/risk
                    let nodeColor = this.currentTheme.success;
                    if (i % 4 === 0) nodeColor = this.currentTheme.accent;
                    if (i % 4 === 1) nodeColor = this.currentTheme.warning;
                    if (i % 4 === 2) nodeColor = this.currentTheme.danger;

                    ctx.fillStyle = nodeColor;
                    ctx.beginPath();
                    ctx.arc(nodeX, nodeY, 8, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.strokeStyle = this.currentTheme.bgSecondary;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                // Draw label
                ctx.fillStyle = this.currentTheme.textPrimary;
                ctx.font = 'bold 14px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText(`${label} (${size} nodes)`, x, y + radius + 25);
            }

            // Cleanup method to prevent memory leaks
            destroy() {
                this.charts.forEach(chart => chart.destroy());
                this.charts.clear();
            }
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }
    </script>
    <script>


        document.addEventListener('DOMContentLoaded', function () {
            try {
                const analyticsData = {{ analytics_data| safe }}

                const commandPalette = new CommandPalette(analyticsData);
                const analyticsManager = new AnalyticsManager(analyticsData);

                window.commandPalette = commandPalette;
                window.analyticsManager = analyticsManager;

                console.log('Command palette initialized successfully');
            } catch (error) {
                console.error('Failed to initialize command palette:', error);

                document.getElementById('statsGrid').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value"></div>
                        <div class="stat-label">Data Loading Error</div>
                    </div>
                `;
            }
        });
    </script>
</body>

</html>